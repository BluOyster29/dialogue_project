<?xml version="1.0" encoding="utf-8"?>

<vxml version="2.1" xmlns="http://www.w3.org/2001/vxml"
      xmlns:voxeo="http://community.voxeo.com/xmlns/vxml">
  <!--
  <script> <![CDATA[ 
    
    var name = [];

    function add_letter(letter){
      name.push(letter);
      return name
      
    }

    function read_name(){
      name = name.join('');
      return name.toString()

  }

  function reset_name(name){
    name = [];
    return name
  }

    ]]></script> 

  -->

  <script src="{{url_for('static', filename='game_script.js')}}"></script>

  <!-- State machine -->

  <link next="level_one">
  <grammar mode="voice" version="1.0" root="root">
    <rule id="root" scope="public">
       <item>skip</item>>
    </rule>
  </grammar>
</link>

  <form id="welcome">
    <block>
    <prompt bargein ="false">
      Welcome to Rob's trivia game first let's get your name. please spell out your name letter by letter. When you are done say, finished. 
      I will repeat the words after you, if I get it wrong just say, start over.
    </prompt>
    <goto next="#spelling"/>
    </block>
  </form>
        
     
    
  <form id="spelling">
    <field name="addLetter">
      <grammar src="grammars/main_menu_grammar.xml#name"/>
    </field>
    <filled>
      <if cond="addLetter == 'finished'">
        <assign name="playerName" expr="read_name()"/> 
        <goto next="#nameConfirmation"/>

      <elseif cond="addLetter == 'start over'"/>
        <assign name="name" expr="reset_name(name)"/>
        <prompt>
          Starting over
        </prompt>
        <goto next="#spelling"/>

      <else/>
        <value expr="addLetter"/>
        <assign name="name" expr="add_letter(addLetter)"/>
        <goto next="#spelling"/>
      </if>
    </filled>
  </form>

  <form id="nameConfirmation">
    <field name="isCorrect">
      <prompt>
        I got <value expr="playerName"/>, is this correct?
      </prompt>
      <option>Yes</option> 
      <option>no</option>
    </field>
    <filled>
      <if cond="isCorrect == 'no'">
        <prompt>
          Sorry but we don't have enough time to try again. I will give you a default name. 
          
        </prompt>
        <assign name="playerName" expr="'Robby Bob Socks'"/>
        Your name is now
        <value expr="playerName"/>
        .
        <goto next="#question_one"/>
      <else/>
        Awesome.
        <goto next="#question_one"/>
      </if>
    </filled>
  </form>
  
    <form id="question_one">
        <field name="q1">
	  <grammar src="grammars/easy_grammar.xml"/>
            <prompt bargein ="false">
            <grammar src="grammars/easy_grammar.xml#q1"/>
                Hello <value expr="playerName"/>,
                Repeat after me.
                Greek, grapes
            </prompt>
            <nomatch>
                <if cond="lives == '0'">
                        <goto next="fail"/>
                

                <elseif cond="tries == '0'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#questionTwo"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        </field>

        <filled>
          <prompt>
	        Well done! You said: <value expr="q1$.utterance"/>,
	        <break time ="2s"/>
	    </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#questionTwo"/>
	    </filled>
    </form>

    <form id ="questionTwo">
        <field name = "q2">
            <assign name="tries" expr="reset(tries)"/>"
            <grammar src="grammars/easy_grammar.xml"/>
            <prompt> Here Comes another! You currently have <value expr="score"/> points. Now try,</prompt>>
            <prompt>
                <grammar src="grammars/easy_grammar.xml#q2"/>
                Unique, New, York.
            </prompt>
            <nomatch>
                <if cond="lives == '0'">
                        <goto next="fail"/>
                
                <elseif cond="tries == '0'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#question_three"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        </field>
        <filled>
          <prompt>
	        Well done! You said: <value expr="q2$.utterance"/>,
	        <break time ="2s"/>
	        </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#question_three"/>
	    </filled>  
    </form>
    
    <form id ="question_three">
        <field name = "q3">
            <grammar src="grammars/easy_grammar.xml"/>
            <prompt>
                <grammar src="grammars/easy_grammar.xml#q3"/>
                Getting better, nice! Here comes another.
                Red, lorry, yellow, lorry
            </prompt>
        <nomatch>
                <if cond="lives == '0'">
                        <goto next="fail"/>
                
                <elseif cond="tries == '0'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#question_four"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        </field>

        <filled>
          <prompt>
	        Well done! You said: <value expr="q3$.utterance"/>,
	        <break time ="2s"/>
	        </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#question_four"/>
	    </filled>  
    </form>

    <form id ="question_four">
        <field name = "q4">
            <grammar src="grammars/easy_grammar.xml"/>
            <prompt>
                <grammar src="grammars/easy_grammar.xml#q4"/>
                Well done. Now here is another, repeat after me.
                She says cheese
            </prompt>
        <nomatch>
                <if cond="lives == '0'">
                        <goto next="fail"/>
                
                <elseif cond="tries == '0'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#question_five"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        </field>

        <filled>
          <prompt>
	        Well done! You said: <value expr="q4$.utterance"/>,
	        <break time ="2s"/>
	        </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#question_five"/>
	    </filled>  
    </form>

    <form id ="question_five">
        <field name = "q5">
            <grammar src="grammars/easy_grammar.xml"/>
            <prompt>
                <grammar src="grammars/easy_grammar.xml#q5"/>
                Here is the final easy twister. You currently have <value expr="score"/> points. It's a bit tougher than the last.
                Fred fed Ted bread and Ted fed Fred Bread 
            </prompt>
        </field>
        <nomatch>
                <if cond="lives == '0'">
                        <goto next="fail"/>
                
                <elseif cond="tries == '0'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#question_five"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        <filled>
          <prompt>
	        Well done! You said: <value expr="q5$.utterance"/>,
	        <break time ="2s"/>
	        </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="level_two"/>
	    </filled>  
    </form>

</vxml>
