<?xml version="1.0" encoding="utf-8"?>

<vxml version="2.1" xmlns="http://www.w3.org/2001/vxml"
      xmlns:voxeo="http://community.voxeo.com/xmlns/vxml">

  <script> <![CDATA[ 
    
    var name = [];

    function add_letter(letter){
      name.push(letter);
      return name
      
    }

    function read_name(){
      name = name.join('');
      return name.toString()

  }

  function reset_name(name){
    name = [];
    return name
  }

    ]]></script> 


  <!-- State machine -->
  <form id="welcome">
    <block>
    <prompt bargein ="false">
      Welcome, please spell out your name letter by letter. When you are done say, finished. 
      I will repeat the words after you, if I get it wrong just say, start over.
    </prompt>
    <goto next="#spelling"/>
    </block>
  </form>
        
     
    
  <form id="spelling">
    <field name="addLetter">
      <grammar src="grammars/main_menu_grammar.xml#name"/>
    </field>
    <filled>
      <if cond="addLetter == 'finished'">
        <assign name="playerName" expr="read_name()"/> 
        <goto next="#nameConfirmation"/>

      <elseif cond="addLetter == 'start over'"/>
        <assign name="name" expr="reset_name(name)"/>
        <prompt>
          Starting over
        </prompt>
        <goto next="#spelling"/>

      <else/>
        <value expr="addLetter"/>
        <assign name="name" expr="add_letter(addLetter)"/>
        <goto next="#spelling"/>
      </if>
    </filled>
  </form>

  <form id="nameConfirmation">
    <field name="isCorrect">
      <prompt>
        I got <value expr="playerName"/>, is this correct?
      </prompt>
      <option>Yes</option> 
      <option>no</option>
    </field>
    <filled>
      <if cond="isCorrect == 'no'">
        <prompt>
          Sorry but we don't have enough time to try again. I will give you a default name. 
          
        </prompt>
        <assign name="playerName" expr="'Player One'"/>
        <value expr="playerName"/>
        <goto next="#mainMenu"/>
      <else/>
        Awesome.
        <goto next="#mainMenu"/>
      </if>
    </filled>
  </form>
      
            
  

<menu id="mainMenu">
  <prompt>
    This is the main menu where you will make some choices. Please say whether you would 
    like to play in easy mode, medium mode, or hard mode. 
  </prompt>
  <choice next="easy">
    Easy mode
  </choice>
  <choice next="medium">
    medium mode
  </choice>
  <choice next="hard">
    hard mode
  </choice>
  
</menu>

</vxml>
