<?xml version="1.0" encoding="utf-8"?>

<vxml version="2.1" xmlns="http://www.w3.org/2001/vxml"
      xmlns:voxeo="http://community.voxeo.com/xmlns/vxml">


  <script src="{{url_for('static', filename='game_script.js')}}"></script>

  <!-- State machine -->
  <!--
  <link next="">
  <grammar mode="voice" version="1.0" root="root">
    <rule id="root" scope="public">
       <item>skip</item>>
    </rule>
  </grammar>
</link>
-->

  <form id="welcome">
    <assign name="time_start" expr="start()"/>
    <block>
    <prompt bargein ="false">
      
      Welcome to Rob's trivia game. first let's get your name. please spell out your name using the nato alphabet. When you are done say, finished. 
      I will repeat the words after you, if I get it wrong just say start over.
      
    </prompt>
    <goto next="#completion"/>
    </block>
  </form>
        

  <form id="spelling">
    <field name="addLetter">
      <grammar src="grammars/main_menu_grammar.xml#name"/>
    </field>
    <filled>
      <if cond="addLetter == 'finished'">
        <assign name="playerName" expr="read_name()"/> 
        <goto next="#nameConfirmation"/>

      <elseif cond="addLetter == 'start over'"/>
        <assign name="name" expr="reset_name(name)"/>
        <prompt>
          Starting over
        </prompt>
        <goto next="#spelling"/>

      <else/>
        <value expr="addLetter"/>
        <assign name="name" expr="add_letter(addLetter)"/>
        <goto next="#spelling"/>
      </if>
    </filled>
  </form>

  <form id="nameConfirmation">
    <field name="isCorrect">
      <prompt>
        I got <value expr="playerName"/>, is this correct?
      </prompt>
      <option>Yes</option> 
      <option>no</option>
    </field>
    <filled>
      <if cond="isCorrect == 'no'">
        <prompt>
          Sorry but we don't have enough time to try again. I will give you a default name. 
          
        </prompt>
        <assign name="playerName" expr="'Robby Bob Socks'"/>
        Your name is now
        <value expr="playerName"/>
        .
        <goto next="#question_one"/>
      <else/>
        Awesome.
        <goto next="#question_one"/>
      </if>
    </filled>
  </form>
  
    <form id="question_one">
        <field name="q1">
	  <grammar src="grammars/easy_grammar.xml"/>
            <prompt bargein ="false">
            <grammar src="grammars/easy_grammar.xml#q1"/>
                Hello <value expr="playerName"/>, let's get started. I will ask you to repeat after me 
                some English tongue twisters, you have three tries for this round and ten lives in total.
                If you use all your tries you lose a life. Tries reset at the end of every round. Good luck! 
                Here comes the first tongue twister.
                Repeat after me.
                Greek, grapes
            </prompt>
            <nomatch>
                <if cond="lives == '1'">
                        <goto next="fail"/>
                

                <elseif cond="tries == '1'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#questionTwo"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        That's not quite it, you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        </field>

        <filled>
          <prompt>
	        Well done! You said: <value expr="q1$.utterance"/>,
	        <break time ="2s"/>
	    </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#questionTwo"/>
	    </filled>
    </form>

    <form id ="questionTwo">
        <field name = "q2">
            <assign name="tries" expr="reset(tries)"/>"
            <grammar src="grammars/easy_grammar.xml"/>
            <prompt> Here is the second one. Now try,</prompt>>
            <prompt>
                <grammar src="grammars/easy_grammar.xml#q2"/>
                Unique, New, York.
            </prompt>
            <nomatch>
                <if cond="lives == '1'">
                        <goto next="fail"/>
                
                <elseif cond="tries == '1'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#question_three"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        </field>
        <filled>
          <prompt>
	        Well done! You said: <value expr="q2$.utterance"/>,
	        <break time ="2s"/>
	        </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#question_three"/>
	    </filled>  
    </form>
    
    <form id ="question_three">
        <field name = "q3">
            <grammar src="grammars/easy_grammar.xml"/>
            <prompt>
                <grammar src="grammars/easy_grammar.xml#q3"/>
                Getting better, nice! Here comes another.
                Red lorry yellow lorry
            </prompt>
        <nomatch>
                <if cond="lives == '1'">
                        <goto next="fail"/>
                
                <elseif cond="tries == '1'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#question_four"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        </field>

        <filled>
          <prompt>
	        Well done! You said: <value expr="q3$.utterance"/>,
	        <break time ="2s"/>
	        </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#question_four"/>
	    </filled>  
    </form>

    <form id ="question_four">
        <field name = "q4">
            <grammar src="grammars/easy_grammar.xml"/>
            <prompt>
                <grammar src="grammars/easy_grammar.xml#q4"/>
                Now here is another, repeat after me.
                She says cheese
            </prompt>
        <nomatch>
                <if cond="lives == '1'">
                        <goto next="fail"/>
                
                <elseif cond="tries == '1'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#question_five"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        </field>

        <filled>
          <prompt>
	        Well done! You said: <value expr="q4$.utterance"/>,
	        <break time ="2s"/>
	        </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#question_five"/>
	    </filled>  
    </form>

    <form id ="question_five">
        <field name = "q5">
            <grammar src="grammars/easy_grammar.xml"/>
            <prompt>
                <grammar src="grammars/easy_grammar.xml#q5"/>
                Here is the final easy twister. You currently have <value expr="score"/> points. It's a bit tougher than the last.
                Fred fed Ted bread and Ted fed Fred Bread 
            </prompt>
        </field>
        <nomatch>
                <if cond="lives == '1'">
                        <goto next="fail"/>
                
                <elseif cond="tries == '1'"/>
                    <assign name="lives" expr="minus_point(lives)"/>
                    <prompt bargein ="false">
                        sorry you have run out of tries, you lose a life, next question.
                    </prompt>
                    <goto next="#level_two"/>
                
                <else/>
                    <assign name="tries" expr="minus_point(tries)"/>
                    <prompt>
                        you have <value expr="tries"/> tries remaining. 
                    </prompt>
                </if>
            </nomatch>
        <filled>
          <prompt>
	        Well done! You said: <value expr="q5$.utterance"/>,
	        <break time ="2s"/>
	        </prompt>
        <assign name="score" expr="add_point(score)"/>
	    <goto next="#level_two"/>
	    </filled>  
    </form>

  <form id="level_two">
    <field id="question_1">
      <assign name="tries" expr="reset_tries(tries)"/>
      <grammar src="/grammars/intro_round_grammar.xml#q1"/>
      <prompt> Well done <value expr="playerName"/>, You have made it to level two!
      You have <value expr="score"/> points, and <value expr="lives"/> lives.
      In this next round will be an intros round. Rob the creator will sing an 
      intro and you have to guess what it is! Good luck.
      </prompt>
      <prompt>
        Here is the first one. 
      </prompt>
      <audio src="/audio/metal.wav"/>
      <prompt>
        Was it A, Free Bird,
        Was it B, Sweet child of mine, 
        Was it C, another one bites the dust,
        Or was it D, Without me.
      </prompt>
      <prompt></prompt>
    </field>
    <nomatch>
        <if cond="lives=='1'">
          <goto next="#fail"/>
      
        <elseif cond="tries == '1'"/>
          <prompt>
            You are out of tries, you lose a life. Next question!
          </prompt>
          <goto next="#question_2"/>
        <else/>
          <assign name="tries" expr="minus_point(tries)"/>
          <prompt>
            That is wrong. You have <value expr="tries"/> tries remaining.
            Try again.
          </prompt>
        </if>  
      </nomatch>
    <filled>
      <prompt>
        Great job that's correct
      </prompt>
      <assign name="score" expr="add_point(score)"/>    
      <goto next="#question_2"/>
    </filled>
  </form>

  <form id="question_2">
    <field id="question_2">
      <assign name="tries" expr="reset_tries(tries)"/>
      <grammar src="/grammars/intro_round_grammar.xml#q2"/>
      <prompt> Here comes another.
      </prompt>
      <audio src="audio/generation.wav"/>
      <prompt>
        Was it A, Highway to Hell,
        Was it B, My Generation, 
        Was it C, Bohemian Rhapsody,
        Or was it D, Run to the hills.
      </prompt>
    </field>
    <nomatch>
        <if cond="lives=='1'">
          <goto next="#fail"/>
      
        <elseif cond="tries == '1'"/>
          <prompt>
            You are out of tries, you lose a life. Next question!
            <goto next="#question_3"/>
          </prompt>
        <else/>
          <assign name="tries" expr="minus_point(tries)"/>
          <prompt>
            That is wrong. You have <value expr="tries"/> tries remaining.
            Try again.
          </prompt>
        </if>  
      </nomatch>
    <filled>
      <prompt>
        Great job that's correct
      </prompt>
      <assign name="score" expr="add_point(score)"/>    
      <goto next="#completion"/>
    </filled>
  </form>

  <form id="question_3">
    <field id="question_3">
      <assign name="tries" expr="reset_tries(tries)"/>
      <grammar src="/grammars/intro_round_grammar.xml#q3"/>
      <prompt> Here comes another.
      </prompt>
      <audio src="audio/generation.wav"/>
      <prompt>
        Was it A, ,
        Was it B, , 
        Was it C, ,
        Or was it D, .
      </prompt>
    </field>
    <nomatch>
        <if cond="lives=='1'">
          <goto next="#fail"/>
      
        <elseif cond="tries == '1'"/>
          <prompt>
            You are out of tries, you lose a life. Next question!
            <goto next="#question_4"/>
          </prompt>
        <else/>
          <assign name="tries" expr="minus_point(tries)"/>
          <prompt>
            That is wrong. You have <value expr="tries"/> tries remaining.
            Try again.
          </prompt>
        </if>  
      </nomatch>
    <filled>
      <prompt>
        Great job that's correct
      </prompt>
      <assign name="score" expr="add_point(score)"/>    
      <goto next="#question_4"/>
    </filled>
  </form>

  <form id="question_4">
    <field id="question_4">
      <assign name="tries" expr="reset_tries(tries)"/>
      <grammar src="/grammars/intro_round_grammar.xml#q4"/>
      <prompt> Here comes another.
      </prompt>
      <audio src="audio/generation.wav"/>
      <prompt>
        Was it A, ,
        Was it B, , 
        Was it C, .
        Or was it D, .
      </prompt>
    </field>
    <nomatch>
        <if cond="lives=='1'">
          <goto next="#fail"/>
      
        <elseif cond="tries == '1'"/>
          <prompt>
            You are out of tries, you lose a life. Next question!
            <goto next="#question_2"/>
          </prompt>
        <else/>
          <assign name="tries" expr="minus_point(tries)"/>
          <prompt>
            That is wrong. You have <value expr="tries"/> tries remaining.
            Try again.
          </prompt>
        </if>  
      </nomatch>
    <filled>
      <prompt>
        Great job that's correct
      </prompt>
      <assign name="score" expr="add_point(score)"/>    
      <goto next="#question_3"/>
    </filled>
  </form>

  <form id="question_5">
    <field id="question_5">
      <assign name="tries" expr="reset_tries(tries)"/>
      <grammar src="/grammars/intro_round_grammar.xml#q5"/>
      <prompt> Here comes another.
      </prompt>
      <audio src="audio/generation.wav"/>
      <prompt>
        Was it A, H,
        Was it B, , 
        Was it C, ,
        Or was it D, .
      </prompt>
    </field>
    <nomatch>
        <if cond="lives=='1'">
          <goto next="#fail"/>
      
        <elseif cond="tries == '1'"/>
          <prompt>
            You are out of tries, you lose a life. Next question!
            <goto next="#question_2"/>
          </prompt>
        <else/>
          <assign name="tries" expr="minus_point(tries)"/>
          <prompt>
            That is wrong. You have <value expr="tries"/> tries remaining.
            Try again.
          </prompt>
        </if>  
      </nomatch>
    <filled>
      <prompt>
        Great job that's correct
      </prompt>
      <assign name="score" expr="add_point(score)"/>    
      <goto next="#level_three"/>
    </filled>
  </form>

  <form id="completion">
    
    <field name="congrats">
      
      <prompt>
        Well done <value expr="playerName"/> you have made it to the end of the game!
        You have <value expr="score"/> points and <value expr="lives"/> left. Not bad, we will
        add you to the leader board! I hope you have fun playing, please play again. Would 
        you like to play again?
      </prompt>
      <option>Yes</option>
      <option>no</option>
      
    </field>
    <filled>
      <if cond="congrats='yes'">
        <prompt>Awesome we can play again, if you play again you get to keep
          your score!
        </prompt>
      <else/>
        <assign name="price" expr="end(lives)"/>
        <prompt>
          Fair enough this session cost 20 crowns a minute. Your bill is <value expr="price"/> crowns.
          Please pay immediately.
        </prompt>
      </if>
    </filled>
  </form>

  <form id="failed">

        <field name="failureMessage">
          <assign name="price" expr="end()"/>

            <prompt>
                I am afraid you ahve run out of lives and you only managed to get <value expr="score"/> points, hash tag loser, but that is ok we have a few options.
                If you have enough money you can bribe the government and try again, or accept your 
                fate and exit. What would you like to do? Bribe or exit the game?
            </prompt>
            <option>Bribe</option>
            <option>Exit game</option>
        </field>
        <filled>
            <if cond="failureMessage='bribe'">
                <prompt>You chose bribe! Very British of you, please try again</prompt>
                <goto next="#question_one"/>
                <assign name="lives" expr="reset_lives"/>
            </if>
            <else/>
            <assign name="price" expr="end(lives)"/>
            <prompt>Thanks for playin. The game costs twenty crownd a minute. Your bill is <value expr="price"/> crowns
            . pay Now or prepare to be attacked by robots.</prompt>
        </filled>
    </form>
</vxml>
