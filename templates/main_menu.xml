<?xml version="1.0" encoding="utf-8"?>

<vxml version="2.1" xmlns="http://www.w3.org/2001/vxml"
      xmlns:voxeo="http://community.voxeo.com/xmlns/vxml">
  <!--
  <script> <![CDATA[ 
    
    var name = [];

    function add_letter(letter){
      name.push(letter);
      return name
      
    }

    function read_name(){
      name = name.join('');
      return name.toString()

  }

  function reset_name(name){
    name = [];
    return name
  }

    ]]></script> 

  -->

  <script src="{{url_for('static', filename='game_script.js')}}"></script>

  <!-- State machine -->

  <link next="level_one">
  <grammar mode="voice" version="1.0" root="root">
    <rule id="root" scope="public">
       <item>skip</item>>
    </rule>
  </grammar>
</link>

  <form id="welcome">
    <block>
    <prompt bargein ="false">
      Welcome to Rob's trivia game first let's get your name. please spell out your name letter by letter. When you are done say, finished. 
      I will repeat the words after you, if I get it wrong just say, start over.
    </prompt>
    <goto next="#spelling"/>
    </block>
  </form>
        
     
    
  <form id="spelling">
    <field name="addLetter">
      <grammar src="grammars/main_menu_grammar.xml#name"/>
    </field>
    <filled>
      <if cond="addLetter == 'finished'">
        <assign name="playerName" expr="read_name()"/> 
        <goto next="#nameConfirmation"/>

      <elseif cond="addLetter == 'start over'"/>
        <assign name="name" expr="reset_name(name)"/>
        <prompt>
          Starting over
        </prompt>
        <goto next="#spelling"/>

      <else/>
        <value expr="addLetter"/>
        <assign name="name" expr="add_letter(addLetter)"/>
        <goto next="#spelling"/>
      </if>
    </filled>
  </form>

  <form id="nameConfirmation">
    <field name="isCorrect">
      <prompt>
        I got <value expr="playerName"/>, is this correct?
      </prompt>
      <option>Yes</option> 
      <option>no</option>
    </field>
    <filled>
      <if cond="isCorrect == 'no'">
        <prompt>
          Sorry but we don't have enough time to try again. I will give you a default name. 
          
        </prompt>
        <assign name="playerName" expr="'Robby Bob Socks'"/>
        Your name is now
        <value expr="playerName"/>
        .
        <goto next="level_one"/>
      <else/>
        Awesome.
        <goto next="level_one"/>
      </if>
    </filled>
  </form>
      
</vxml>
